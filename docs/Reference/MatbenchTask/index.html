
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A benchmark and leaderboard for predicting materials properties">
      
      
      
      <link rel="icon" href="../../static/matbench_logo_favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.2.15">
    
    
      
        <title>MatbenchTask - MatBench</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#757575">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent="green">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#matbenchtask" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MatBench" class="md-header__button md-logo" aria-label="MatBench" data-md-component="logo">
      
  <img src="../../static/matbench_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MatBench
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MatbenchTask
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hackingmaterials/matbench" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Leaderboard
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Benchmark%20Info/matbench_v0.1/" class="md-tabs__link">
        Benchmark Info
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_Ax_10_90_CrabNet_v1.2.7/" class="md-tabs__link">
        Full Benchmark Data
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../How%20To%20Use/1install/" class="md-tabs__link">
        How To Use
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_dielectric/" class="md-tabs__link">
        Leaderboards Per Task
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../MatbenchBenchmark/" class="md-tabs__link md-tabs__link--active">
        Reference
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MatBench" class="md-nav__button md-logo" aria-label="MatBench" data-md-component="logo">
      
  <img src="../../static/matbench_logo.png" alt="logo">

    </a>
    MatBench
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hackingmaterials/matbench" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Leaderboard
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Benchmark Info
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Benchmark Info" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Benchmark Info
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Benchmark%20Info/matbench_v0.1/" class="md-nav__link">
        Benchmark info for `matbench_v0.1`
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Benchmark%20Info/notes/" class="md-nav__link">
        Notes on Benchmarking
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Full Benchmark Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Full Benchmark Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Full Benchmark Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_Ax_10_90_CrabNet_v1.2.7/" class="md-nav__link">
        matbench_v0.1: Ax(10/90)+CrabNet v1.2.7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_Ax_CrabNet_v1.2.1/" class="md-nav__link">
        matbench_v0.1: Ax+CrabNet v1.2.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_Ax_SAASBO_CrabNet_v1.2.7/" class="md-nav__link">
        matbench_v0.1: Ax/SAASBO CrabNet v1.2.7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_CrabNet/" class="md-nav__link">
        matbench_v0.1: CrabNet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_CrabNet_v1.2.1/" class="md-nav__link">
        matbench_v0.1: CrabNet v1.2.1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_RFLR/" class="md-nav__link">
        matbench_v0.1: Random Forest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_alignn/" class="md-nav__link">
        matbench_v0.1: ALIGNN
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_automatminer_expressv2020/" class="md-nav__link">
        matbench_v0.1: AMMExpress v2020
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_cgcnnv2019/" class="md-nav__link">
        matbench_v0.1: CGCNN v2019
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_dummy/" class="md-nav__link">
        matbench_v0.1: Dummy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_lattice_xgboost/" class="md-nav__link">
        matbench_v0.1: Lattice-XGBoost
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_modnet_v0.1.10/" class="md-nav__link">
        matbench_v0.1: MODNet (v0.1.10)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_modnet_v0.1.12/" class="md-nav__link">
        matbench_v0.1: MODNet (v0.1.12)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Full%20Benchmark%20Data/matbench_v0.1_rf/" class="md-nav__link">
        matbench_v0.1: RF-SCM/Magpie
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          How To Use
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="How To Use" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          How To Use
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../How%20To%20Use/1install/" class="md-nav__link">
        1 - Install matbench
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../How%20To%20Use/2run/" class="md-nav__link">
        2 - Run benchmark on algorithm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../How%20To%20Use/3submit/" class="md-nav__link">
        3 - Submit to leaderboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../How%20To%20Use/advanced/" class="md-nav__link">
        Advanced usage
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Leaderboards Per Task
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Leaderboards Per Task" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Leaderboards Per Task
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_dielectric/" class="md-nav__link">
        matbench_v0.1 matbench_dielectric
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_expt_gap/" class="md-nav__link">
        matbench_v0.1 matbench_expt_gap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_expt_is_metal/" class="md-nav__link">
        matbench_v0.1 matbench_expt_is_metal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_glass/" class="md-nav__link">
        matbench_v0.1 matbench_glass
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_jdft2d/" class="md-nav__link">
        matbench_v0.1 matbench_jdft2d
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_log_gvrh/" class="md-nav__link">
        matbench_v0.1 matbench_log_gvrh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_log_kvrh/" class="md-nav__link">
        matbench_v0.1 matbench_log_kvrh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_mp_e_form/" class="md-nav__link">
        matbench_v0.1 matbench_mp_e_form
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_mp_gap/" class="md-nav__link">
        matbench_v0.1 matbench_mp_gap
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_mp_is_metal/" class="md-nav__link">
        matbench_v0.1 matbench_mp_is_metal
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_perovskites/" class="md-nav__link">
        matbench_v0.1 matbench_perovskites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_phonons/" class="md-nav__link">
        matbench_v0.1 matbench_phonons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Leaderboards%20Per-Task/matbench_v0.1_matbench_steels/" class="md-nav__link">
        matbench_v0.1 matbench_steels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../MatbenchBenchmark/" class="md-nav__link">
        MatbenchBenchmark
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          MatbenchTask
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        MatbenchTask
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask" class="md-nav__link">
    matbench.task.MatbenchTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.all_folds_recorded" class="md-nav__link">
    all_folds_recorded
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.has_polymorphs" class="md-nav__link">
    has_polymorphs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.is_recorded" class="md-nav__link">
    is_recorded
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.scores" class="md-nav__link">
    scores
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.as_dict" class="md-nav__link">
    as_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.get_test_data" class="md-nav__link">
    get_test_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.get_train_and_val_data" class="md-nav__link">
    get_train_and_val_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.load" class="md-nav__link">
    load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.record" class="md-nav__link">
    record()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.validate" class="md-nav__link">
    validate()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask" class="md-nav__link">
    matbench.task.MatbenchTask
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.all_folds_recorded" class="md-nav__link">
    all_folds_recorded
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.has_polymorphs" class="md-nav__link">
    has_polymorphs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.is_recorded" class="md-nav__link">
    is_recorded
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.scores" class="md-nav__link">
    scores
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.as_dict" class="md-nav__link">
    as_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.from_dict" class="md-nav__link">
    from_dict()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.get_test_data" class="md-nav__link">
    get_test_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.get_train_and_val_data" class="md-nav__link">
    get_train_and_val_data()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.load" class="md-nav__link">
    load()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.record" class="md-nav__link">
    record()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#matbench.task.MatbenchTask.validate" class="md-nav__link">
    validate()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/hackingmaterials/matbench/edit/master/docs/Reference/MatbenchTask.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="matbenchtask">MatbenchTask</h1>


  <div class="doc doc-object doc-class">

<a id="matbench.task.MatbenchTask"></a>
    <div class="doc doc-contents first">

      <p>The core interface for running a Matbench task and recording its results.</p>
<p>MatbenchTask handles creating training/validation and testing sets, as
well as recording and managing all data in a consistent fashion.
MatbenchTask also validates data according to te specifications in the
validation file.</p>
<p>MatbenchTasks have a few core methods:</p>
<ul>
<li>MatbenchTask.get_train_and_val_data: Get nested cross validation data to
    be used for all training and validation.</li>
<li>MatbenchTask.get_test_data: Get test data for nested cross validation.</li>
<li>MatbenchTask.record: Record your predicted results for the test data.</li>
<li>MatbenchTask.validate: Check to make sure the data you recorded for this
    task is valid.</li>
</ul>
<p>You can iterate through the folds of a matbench task using .folds and
the .get_*_data methods.</p>
<p>You can load the results of a task without having to load large
datasets themselves. However, to get training and testing data,
you must load the datasets. Tasks loaded from files do not
automatically load the dataset into memory; to load a dataset into memory,
use MatbenchTask.load().</p>
<p>See the full documentation online for more info and tutorials on
using MatbenchTask.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>benchmark_name</code></td>
        <td><code>str</code></td>
        <td><p>The name of the benchmark this task belongs to.</p></td>
      </tr>
      <tr>
        <td><code>df</code></td>
        <td><code>pd.DataFrame</code></td>
        <td><p>the dataframe of the dataset for this task</p></td>
      </tr>
      <tr>
        <td><code>info</code></td>
        <td><code>str</code></td>
        <td><p>Info about this dataset</p></td>
      </tr>
      <tr>
        <td><code>metadata</code></td>
        <td><code>RecursiveDotDict</code></td>
        <td><p>all metadata about this dataset</p></td>
      </tr>
      <tr>
        <td><code>validation</code></td>
        <td><code>RecursiveDotDict</code></td>
        <td><p>The validation specification for this
task, including the training and testing splits for each fold.</p></td>
      </tr>
      <tr>
        <td><code>folds_keys</code></td>
        <td><code>[str]</code></td>
        <td><p>Keys of folds, fold_i for the ith fold.</p></td>
      </tr>
      <tr>
        <td><code>folds_nums</code></td>
        <td><code>[int]</code></td>
        <td><p>Values of folds, i for the ith fold.</p></td>
      </tr>
      <tr>
        <td><code>folds_map</code></td>
        <td><code>{int</code></td>
        <td><p>str}): Mapping of folds_nums to folds_keys</p></td>
      </tr>
      <tr>
        <td><code>folds</code></td>
        <td><code>[int]</code></td>
        <td><p>Alias for folds_nums</p></td>
      </tr>
      <tr>
        <td><code>results</code></td>
        <td><code>RecursiveDotDict</code></td>
        <td><p>all raw results in dict-like form.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MatbenchTask</span><span class="p">(</span><span class="n">MSONable</span><span class="p">,</span> <span class="n">MSONable2File</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The core interface for running a Matbench task and recording its results.</span>

<span class="sd">    MatbenchTask handles creating training/validation and testing sets, as</span>
<span class="sd">    well as recording and managing all data in a consistent fashion.</span>
<span class="sd">    MatbenchTask also validates data according to te specifications in the</span>
<span class="sd">    validation file.</span>

<span class="sd">    MatbenchTasks have a few core methods:</span>

<span class="sd">    - MatbenchTask.get_train_and_val_data: Get nested cross validation data to</span>
<span class="sd">        be used for all training and validation.</span>
<span class="sd">    - MatbenchTask.get_test_data: Get test data for nested cross validation.</span>
<span class="sd">    - MatbenchTask.record: Record your predicted results for the test data.</span>
<span class="sd">    - MatbenchTask.validate: Check to make sure the data you recorded for this</span>
<span class="sd">        task is valid.</span>

<span class="sd">    You can iterate through the folds of a matbench task using .folds and</span>
<span class="sd">    the .get_*_data methods.</span>

<span class="sd">    You can load the results of a task without having to load large</span>
<span class="sd">    datasets themselves. However, to get training and testing data,</span>
<span class="sd">    you must load the datasets. Tasks loaded from files do not</span>
<span class="sd">    automatically load the dataset into memory; to load a dataset into memory,</span>
<span class="sd">    use MatbenchTask.load().</span>

<span class="sd">    See the full documentation online for more info and tutorials on</span>
<span class="sd">    using MatbenchTask.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        benchmark_name (str): The name of the benchmark this task belongs to.</span>
<span class="sd">        df (pd.DataFrame): the dataframe of the dataset for this task</span>
<span class="sd">        info (str): Info about this dataset</span>
<span class="sd">        metadata (RecursiveDotDict): all metadata about this dataset</span>
<span class="sd">        validation (RecursiveDotDict): The validation specification for this</span>
<span class="sd">            task, including the training and testing splits for each fold.</span>
<span class="sd">        folds_keys ([str]): Keys of folds, fold_i for the ith fold.</span>
<span class="sd">        folds_nums ([int]): Values of folds, i for the ith fold.</span>
<span class="sd">        folds_map ({int: str}): Mapping of folds_nums to folds_keys</span>
<span class="sd">        folds ([int]): Alias for folds_nums</span>
<span class="sd">        results (RecursiveDotDict): all raw results in dict-like form.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_RESULTS_KEY</span> <span class="o">=</span> <span class="s2">&quot;results&quot;</span>
    <span class="n">_BENCHMARK_KEY</span> <span class="o">=</span> <span class="s2">&quot;benchmark_name&quot;</span>
    <span class="n">_DATASET_KEY</span> <span class="o">=</span> <span class="s2">&quot;dataset_name&quot;</span>
    <span class="n">_DATA_KEY</span> <span class="o">=</span> <span class="s2">&quot;data&quot;</span>
    <span class="n">_UNCERTAINTY_KEY</span> <span class="o">=</span> <span class="s2">&quot;uncertainty&quot;</span>
    <span class="n">_PARAMS_KEY</span> <span class="o">=</span> <span class="s2">&quot;parameters&quot;</span>
    <span class="n">_SCORES_KEY</span> <span class="o">=</span> <span class="s2">&quot;scores&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">benchmark</span><span class="o">=</span><span class="n">MBV01_KEY</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Args:</span>
<span class="sd">            dataset_name (str): Name of the task. Must belong to the benchmark</span>
<span class="sd">                given in the &#39;benchmark&#39; argument.</span>
<span class="sd">            autoload (bool): If True, will load the benchmark&#39;s raw data. This</span>
<span class="sd">                includes deserializing many large structures for some datasets,</span>
<span class="sd">                so loading make take some time. If False, you will need to</span>
<span class="sd">                run .load() before running .get_*_data() methods.</span>
<span class="sd">            benchmark (str): Name of the benchmark this task belongs to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">autoload</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">get_all_dataset_info</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">)</span>

        <span class="c1"># define all static data needed for this task</span>
        <span class="c1"># including citations, data size, as well as specific validation splits</span>

        <span class="k">if</span> <span class="n">benchmark</span> <span class="o">==</span> <span class="n">MBV01_KEY</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_name</span> <span class="o">=</span> <span class="n">MBV01_KEY</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">mbv01_metadata</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">mbv01_validation</span><span class="o">.</span><span class="n">splits</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Only </span><span class="si">{</span><span class="n">MBV01_KEY</span><span class="si">}</span><span class="s2"> available. No other benchmarks defined!&quot;</span>
            <span class="p">)</span>

        <span class="c1"># keeping track of folds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folds_nums</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folds_nums</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">))</span>

        <span class="c1"># Alias for ease of use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_nums</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">RecursiveDotDict</span><span class="p">({})</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="s2">&quot;input_type mad n_samples target task_type unit&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

        <span class="n">md_str</span> <span class="o">=</span> <span class="s2">&quot;,</span><span class="se">\n</span><span class="s2">  &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="se">\n</span><span class="s2">  dataset_name=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  version&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">benchmark_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;matbench_v&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">  </span><span class="si">{</span><span class="n">md_str</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">)&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_data_from_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private function to get fold data from the task dataframe.</span>

<span class="sd">        Args:</span>
<span class="sd">            ids (list-like): List of string indices to grab from the df.</span>
<span class="sd">            as_type (str): either &quot;df&quot; or &quot;tuple&quot;. If &quot;df&quot;, returns the</span>
<span class="sd">                data as a subset of the task df. If &quot;tuple&quot;, returns</span>
<span class="sd">                list-likes of the inputs and outputs as a 2-tuple.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (pd.DataFrame or (list-like, list-like))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">relevant_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ids</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;df&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">relevant_df</span>
        <span class="k">elif</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;tuple&quot;</span><span class="p">:</span>
            <span class="c1"># inputs, outputs</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">relevant_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">input_type</span><span class="p">],</span>
                <span class="n">relevant_df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">target</span><span class="p">],</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_is_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private method to check if the dataset is loaded.</span>

<span class="sd">        Throws error if the dataset is not loaded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Task dataset is not loaded! Run MatbenchTask.load() to &quot;</span>
                <span class="s2">&quot;load the dataset into memory.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_all_folds_recorded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private method to check if all folds have been recorded.</span>

<span class="sd">        Throws error if all folds have not been recorded.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (str): Error message to be displayed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_folds_recorded</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">; folds &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span><span class="p">[</span><span class="n">f</span><span class="p">]]</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not recorded!&quot;</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a MatbenchTask from a dictionary input.</span>

<span class="sd">        Required method from MSONable.</span>

<span class="sd">        Args:</span>
<span class="sd">            d (dict):</span>

<span class="sd">        Returns:</span>
<span class="sd">            (MatbenchTask)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">req_base_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_DATASET_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_RESULTS_KEY</span><span class="p">,</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_BENCHMARK_KEY</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req_base_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
        <span class="n">extra_base_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_base_keys</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">extra_base_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extra keys </span><span class="si">{</span><span class="n">extra_base_keys</span><span class="si">}</span><span class="s2"> not allowed.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_args</span><span class="p">(</span>
            <span class="n">dataset_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_DATASET_KEY</span><span class="p">],</span>
            <span class="n">benchmark_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BENCHMARK_KEY</span><span class="p">],</span>
            <span class="n">results_dict</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_RESULTS_KEY</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">benchmark_name</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Instantiate a MatbenchTask from a arguments</span>

<span class="sd">        Args:</span>
<span class="sd">            dataset_name (str): The name of the dataset/task</span>
<span class="sd">            benchmark_name (str): The name of the corresponding benchmark</span>
<span class="sd">            results_dict (dict): A formatted dictionary of raw results.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (MatbenchTask)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">benchmark</span><span class="o">=</span><span class="n">benchmark_name</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">RecursiveDotDict</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load the dataset for this task into memory.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> loaded.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> already loaded; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;not reloading dataset.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_train_and_val_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;tuple&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The training + validation data. All model tuning and</span>
<span class="sd">        hyperparameter selection must be done on this data, NOT test data.</span>

<span class="sd">        Args:</span>
<span class="sd">            fold_number:</span>

<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_loaded</span><span class="p">()</span>
        <span class="n">fold_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">train</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;tuple&quot;</span><span class="p">,</span> <span class="n">include_target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The test data used for recording benchmarks.</span>

<span class="sd">        Args:</span>
<span class="sd">            fold_number:</span>

<span class="sd">        Returns:</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_loaded</span><span class="p">()</span>
        <span class="n">fold_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">test</span>
        <span class="k">if</span> <span class="n">include_target</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;tuple&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;df&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)[</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">input_type</span><span class="p">]</span>
                <span class="p">]</span>

    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Record the test data as well as parameters about the model</span>
<span class="sd">        trained on this fold.</span>

<span class="sd">        Args:</span>
<span class="sd">            fold_number (int): The fold number.</span>
<span class="sd">            predictions ([float] or [bool] or np.ndarray): A list of predictions for</span>
<span class="sd">            fold number {fold_number}</span>
<span class="sd">            ci ([tuple] or [list] or np.ndarray): A list of 95% confidence</span>
<span class="sd">            intervals on predictions for fold number {fold_number}. By default</span>
<span class="sd">            None. Only one of `ci` or `std` should be specified, not both.</span>
<span class="sd">            std ([float] or np.ndarray): A list of prediction standard deviations</span>
<span class="sd">            for fold number {fold_number}. By default None. Only one of</span>
<span class="sd">            `ci` or `std` should be specified, not both.</span>
<span class="sd">            params (dict): Any free-form parameters for information</span>
<span class="sd">                about the algorithm on this fold. For example,</span>
<span class="sd">                hyperparameters determined during validation. Parameters</span>
<span class="sd">                must be a dictionary; dictionary types must adhere to</span>
<span class="sd">                the same requirements as in the MatbenchBenchmark.add_metadata</span>
<span class="sd">                docstring.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fold number </span><span class="si">{</span><span class="n">fold_number</span><span class="si">}</span><span class="s2"> already recorded! Aborting record...&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># avoid problems with json serialization</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">ci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sd">&quot;&quot;&quot;Both standard deviation (`std`) and confidence</span>
<span class="sd">                    intervals (`ci`) were specified as kwargs. Only one</span>
<span class="sd">                    should be specified, not both.&quot;&quot;&quot;</span>
                <span class="p">)</span>

            <span class="n">fold_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span>

            <span class="c1"># create map of original df index to prediction, e.g.,</span>
            <span class="c1"># {ix_of_original_df1: prediction1, ... etc.}</span>

            <span class="n">split_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">test</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Prediction outputs must be the same length as the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;inputs! </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">ids_to_predictions</span> <span class="o">=</span> <span class="p">{</span><span class="n">split_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids_to_predictions</span>

            <span class="k">if</span> <span class="n">std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;task_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;`std` and `ci` are not valid kwargs for classification &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;tasks. See &quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;https://github.com/materialsproject/matbench/pull/99/files#issuecomment-1022662192.&quot;</span>  <span class="c1"># noqa: E501</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">low_p</span> <span class="o">=</span> <span class="mf">0.05</span>
                    <span class="n">high_p</span> <span class="o">=</span> <span class="mf">0.95</span>
                    <span class="c1"># convert from two-tail to one-tail probabilities</span>
                    <span class="c1"># for compatibility with `ppf`</span>
                    <span class="c1"># https://stackoverflow.com/a/29562808/13697228</span>
                    <span class="n">low_p</span> <span class="o">=</span> <span class="n">low_p</span> <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="n">high_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">high_p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="c1"># convert std to ci, modified from source:</span>
                    <span class="c1"># https://github.com/uncertainty-toolbox/uncertainty-toolbox/blob/b2f342f6606d1d667bf9583919a663adf8643efe/uncertainty_toolbox/metrics_scoring_rule.py#L187 # noqa: E501</span>
                    <span class="n">pred_l</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">low_p</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>
                    <span class="n">pred_u</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">high_p</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>
                    <span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pred_l</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">pred_u</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="n">ci</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">std</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># std calculated and stored iff ci is symmetric within tol</span>
                    <span class="n">pred_l</span><span class="p">,</span> <span class="n">pred_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ci</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="o">-</span><span class="n">pred_l</span><span class="p">,</span> <span class="n">pred_u</span><span class="p">):</span>
                        <span class="n">high_p</span> <span class="o">=</span> <span class="mf">0.95</span>
                        <span class="c1"># convert from two-tail to one-tail probabilities for</span>
                        <span class="c1"># compatibility with `ppf`</span>
                        <span class="c1"># https://stackoverflow.com/a/29562808/13697228</span>
                        <span class="n">high_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">high_p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                        <span class="n">std</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_u</span> <span class="o">-</span> <span class="n">pred_l</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">high_p</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">std</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Confidence interval outputs (derived from standard</span>
<span class="s2">                         deviations if `std` was supplied) must be the same</span>
<span class="s2">                         length as the inputs! </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
                    <span class="p">)</span>

                <span class="n">ids_to_uncertainties</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">split_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;ci_lower&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;ci_upper&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">}</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">std</span><span class="p">))</span>
                <span class="p">}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids_to_uncertainties</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Parameters must be stored as a dictionary, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">!&quot;</span>
                <span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">immutify_dictionary</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="n">params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARAMS_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Recorded fold &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">fold_number</span><span class="si">}</span><span class="s2"> successfully.&quot;</span>
            <span class="p">)</span>

            <span class="n">truth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">split_ids</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;tuple&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_array</span><span class="p">(</span>
                <span class="n">truth</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Scored fold &#39;&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2"> successfully.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a MatbenchTask object as a dictionary.</span>

<span class="sd">        Required method from MSONAble.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_BENCHMARK_KEY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_DATASET_KEY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_RESULTS_KEY</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate a task after all folds have been recorded.</span>

<span class="sd">        There are a few requirements for a task to be validated:</span>
<span class="sd">        - Data types of each predicted sample must match those</span>
<span class="sd">            specified by the validation procedure</span>
<span class="sd">        - All folds must be recorded</span>
<span class="sd">        - There must be no extra or missing required keys from</span>
<span class="sd">            the data, including indices. Every index specified in</span>
<span class="sd">            the validation procedure must be present in its</span>
<span class="sd">            correct fold, and no extras may be present.</span>
<span class="sd">        - Ensure consistency of the supplied uncertainty values.</span>
<span class="sd">            For example, if std is specified and ci is specified</span>
<span class="sd">            for one sample, it must be specified for all samples.</span>
<span class="sd">            If ci is specified but std is not, that must be</span>
<span class="sd">            consistent for all samples.</span>
<span class="sd">        Returns:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_folds_recorded</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Cannot validate task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;unless all folds recorded!&quot;</span>
        <span class="p">)</span>
        <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span>

        <span class="c1"># Check for extra fold keys</span>
        <span class="n">extra_fold_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">extra_fold_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extra fold keys </span><span class="si">{</span><span class="n">extra_fold_keys</span><span class="si">}</span><span class="s2"> for task &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not allowed.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">fold_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fold_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Required fold data for fold &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not found.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># Check for extra or missing keys inside each fold:</span>
            <span class="c1"># need params, scores, and data.</span>
            <span class="n">req_subfold_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARAMS_KEY</span><span class="p">]</span>
            <span class="n">extra_subfold_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_subfold_keys</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span> <span class="ow">in</span> <span class="n">extra_subfold_keys</span><span class="p">:</span>
                <span class="n">extra_subfold_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extra_subfold_keys</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Extra keys </span><span class="si">{</span><span class="n">extra_subfold_keys</span><span class="si">}</span><span class="s2"> for fold results of &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39; for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">  not allowed.&quot;</span>
                <span class="p">)</span>
            <span class="n">req_subfold_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">subkey</span> <span class="ow">in</span> <span class="n">req_subfold_keys</span><span class="p">:</span>
                <span class="n">fold_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">subkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span>
                    <span class="ow">and</span> <span class="n">subkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fold_results</span>
                <span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Required key &#39;</span><span class="si">{</span><span class="n">subkey</span><span class="si">}</span><span class="s2">&#39; for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;not found for fold &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="n">subkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">:</span>
                    <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="n">subkey</span><span class="p">]</span>
                    <span class="n">metrics</span> <span class="o">=</span> <span class="n">REG_METRICS</span> <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="n">REG_KEY</span> <span class="k">else</span> <span class="n">CLF_METRICS</span>
                    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Required score &#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&#39; for task &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;not found for &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Required score &#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&#39; for task &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;is not float-type for &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39;!&quot;</span>
                            <span class="p">)</span>
                    <span class="n">extra_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">scores</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">extra_metrics</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Extra keys </span><span class="si">{</span><span class="n">extra_metrics</span><span class="si">}</span><span class="s2"> for fold scores of &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39; for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;not allowed.&quot;</span>
                        <span class="p">)</span>

                <span class="c1"># results data indices are cast by json to be strings,</span>
                <span class="c1"># so must be converted to int</span>
                <span class="k">elif</span> <span class="n">subkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">:</span>
                    <span class="n">fold_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

                    <span class="c1"># Ensure all the indices are present with no</span>
                    <span class="c1"># extras for each fold</span>
                    <span class="n">req_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                    <span class="n">remaining_indices</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">req_indices</span><span class="p">)</span>
                    <span class="n">extra_indices</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span> <span class="o">==</span> <span class="n">REG_KEY</span><span class="p">:</span>
                        <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">,)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">fold_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">ix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_indices</span><span class="p">:</span>
                            <span class="n">extra_indices</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">datum</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">allowed_types</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                    <span class="sa">f</span><span class="s2">&quot;Data point &#39;</span><span class="si">{</span><span class="n">ix</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">datum</span><span class="si">}</span><span class="s2">&#39; has data type &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span><span class="si">}</span><span class="s2"> while required type is &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">allowed_types</span><span class="si">}</span><span class="s2"> for task &quot;</span>
                                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> !&quot;</span>
                                <span class="p">)</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span> <span class="o">==</span> <span class="n">CLF_KEY</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                                    <span class="k">if</span> <span class="n">datum</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">datum</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                            <span class="sa">f</span><span class="s2">&quot;Probability estimate &#39;</span><span class="si">{</span><span class="n">ix</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">datum</span><span class="si">}</span><span class="s2">&quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> outside &quot;</span>
                                            <span class="sa">f</span><span class="s2">&quot;of range [0, 1].&quot;</span>
                                        <span class="p">)</span>

                            <span class="n">remaining_indices</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">extra_indices</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">remaining_indices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extra_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> extra indices for problem &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> are not allowed (found in &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">remaining_indices</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">extra_indices</span> <span class="ow">and</span> <span class="n">remaining_indices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> required indices &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;for problem </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;found for </span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">remaining_indices</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">extra_indices</span> <span class="ow">and</span> <span class="n">remaining_indices</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> required indices &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;for problem </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;found and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extra_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> not &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;allowed indices found for </span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">!&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="k">elif</span> <span class="n">subkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="n">subkey</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">uncertainties</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">uncertainties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">std</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
                        <span class="n">ci</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="s2">&quot;ci&quot;</span><span class="p">]</span>

                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                        <span class="s2">&quot;std specified for all samples &quot;</span>
                                        <span class="s2">&quot;but ci not specified for some.&quot;</span>
                                    <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                    <span class="s2">&quot;std is specified for some, but not for all.&quot;</span>
                                <span class="p">)</span>

                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                        <span class="s2">&quot;ci specified for all samples &quot;</span>
                                        <span class="s2">&quot;but ci not specified for some.&quot;</span>
                                    <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                    <span class="s2">&quot;ci is specified for some, but not for all.&quot;</span>
                                <span class="p">)</span>

                <span class="c1"># Params key has no required form;</span>
                <span class="c1"># it is up to the model to determine it.</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> successfully validated.&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Comprehensive score metrics for this task.</span>

<span class="sd">        Gets means, maxes, mins, and more distribution stats (across folds)</span>
<span class="sd">        for all scoring metrics defined for this task.</span>

<span class="sd">        There will be different scores for classification problems and</span>
<span class="sd">        regression problems.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (dict): A dictionary of all the scores for this task.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metric_keys</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">REG_METRICS</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span> <span class="o">==</span> <span class="n">REG_KEY</span> <span class="k">else</span> <span class="n">CLF_METRICS</span>
        <span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_folds_recorded</span><span class="p">(</span><span class="s2">&quot;Cannot score unless all folds are recorded!&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mk</span> <span class="ow">in</span> <span class="n">metric_keys</span><span class="p">:</span>
            <span class="n">metric</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="c1"># scores for a metric among all folds</span>
            <span class="n">raw_metrics_on_folds</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fk</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">][</span><span class="n">mk</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">fk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">FOLD_DIST_METRICS</span><span class="p">:</span>
                <span class="n">metric</span><span class="p">[</span><span class="n">op</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">np</span><span class="p">,</span> <span class="n">op</span><span class="p">)(</span><span class="n">raw_metrics_on_folds</span><span class="p">)</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">mk</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="k">return</span> <span class="n">RecursiveDotDict</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_recorded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine what folds in the task are recorded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ({int: bool}): Keys are fold numbers, values are whether the</span>
<span class="sd">                fold is recorded or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_recorded</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">fnum</span><span class="p">,</span> <span class="n">fkey</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fkey</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">]:</span>
                <span class="n">is_recorded</span><span class="p">[</span><span class="n">fnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_recorded</span><span class="p">[</span><span class="n">fnum</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">is_recorded</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">all_folds_recorded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if all folds are recorded.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (bool): True if all folds are recorded, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_polymorphs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if a task&#39;s raw data contains polymorphs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            (bool) If true, contains polymorphs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">checker_key</span> <span class="o">=</span> <span class="s2">&quot;pmg_composition&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_loaded</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;composition&quot;</span><span class="p">:</span>
            <span class="n">stc</span> <span class="o">=</span> <span class="n">StrToComposition</span><span class="p">(</span><span class="n">target_col_id</span><span class="o">=</span><span class="n">checker_key</span><span class="p">,</span> <span class="n">reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">comps</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">featurize_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;composition&quot;</span><span class="p">)[</span>
                <span class="n">checker_key</span>
            <span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">input_type</span> <span class="o">==</span> <span class="s2">&quot;structure&quot;</span><span class="p">:</span>
            <span class="n">stc</span> <span class="o">=</span> <span class="n">StructureToComposition</span><span class="p">(</span><span class="n">target_col_id</span><span class="o">=</span><span class="n">checker_key</span><span class="p">,</span> <span class="n">reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">comps</span> <span class="o">=</span> <span class="n">stc</span><span class="o">.</span><span class="n">featurize_dataframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;structure&quot;</span><span class="p">)[</span><span class="n">checker_key</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Cannot check for polymorphs without input type in &quot;</span>
                <span class="s2">&quot;(structure, composition)!&quot;</span>
            <span class="p">)</span>

        <span class="n">unique_comps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">comps</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_comps</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">comps</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






  <div class="doc doc-object doc-attribute">



<h2 id="matbench.task.MatbenchTask.all_folds_recorded" class="doc doc-heading">
<code class="highlight language-python"><span class="n">all_folds_recorded</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Determine if all folds are recorded.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(bool)</code></td>
      <td><p>True if all folds are recorded, False otherwise.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="matbench.task.MatbenchTask.has_polymorphs" class="doc doc-heading">
<code class="highlight language-python"><span class="n">has_polymorphs</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Determine if a task's raw data contains polymorphs.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>(bool) If true, contains polymorphs.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="matbench.task.MatbenchTask.is_recorded" class="doc doc-heading">
<code class="highlight language-python"><span class="n">is_recorded</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Determine what folds in the task are recorded.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>({int</code></td>
      <td><p>bool}): Keys are fold numbers, values are whether the
    fold is recorded or not.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>



  <div class="doc doc-object doc-attribute">



<h2 id="matbench.task.MatbenchTask.scores" class="doc doc-heading">
<code class="highlight language-python"><span class="n">scores</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-property"><code>property</code></small>
      <small class="doc doc-property doc-property-readonly"><code>readonly</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Comprehensive score metrics for this task.</p>
<p>Gets means, maxes, mins, and more distribution stats (across folds)
for all scoring metrics defined for this task.</p>
<p>There will be different scores for classification problems and
regression problems.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>(dict)</code></td>
      <td><p>A dictionary of all the scores for this task.</p></td>
    </tr>
  </tbody>
</table>    </div>

  </div>






  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">benchmark</span><span class="o">=</span><span class="s1">&#39;matbench_v0.1&#39;</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">


<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>dataset_name</code></td>
        <td><code>str</code></td>
        <td><p>Name of the task. Must belong to the benchmark
given in the 'benchmark' argument.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>autoload</code></td>
        <td><code>bool</code></td>
        <td><p>If True, will load the benchmark's raw data. This
includes deserializing many large structures for some datasets,
so loading make take some time. If False, you will need to
run .load() before running .get_*_data() methods.</p></td>
        <td><code>True</code></td>
      </tr>
      <tr>
        <td><code>benchmark</code></td>
        <td><code>str</code></td>
        <td><p>Name of the benchmark this task belongs to.</p></td>
        <td><code>&#39;matbench_v0.1&#39;</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset_name</span><span class="p">,</span> <span class="n">autoload</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">benchmark</span><span class="o">=</span><span class="n">MBV01_KEY</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Args:</span>
<span class="sd">        dataset_name (str): Name of the task. Must belong to the benchmark</span>
<span class="sd">            given in the &#39;benchmark&#39; argument.</span>
<span class="sd">        autoload (bool): If True, will load the benchmark&#39;s raw data. This</span>
<span class="sd">            includes deserializing many large structures for some datasets,</span>
<span class="sd">            so loading make take some time. If False, you will need to</span>
<span class="sd">            run .load() before running .get_*_data() methods.</span>
<span class="sd">        benchmark (str): Name of the benchmark this task belongs to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="n">dataset_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">autoload</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">get_all_dataset_info</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">)</span>

    <span class="c1"># define all static data needed for this task</span>
    <span class="c1"># including citations, data size, as well as specific validation splits</span>

    <span class="k">if</span> <span class="n">benchmark</span> <span class="o">==</span> <span class="n">MBV01_KEY</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_name</span> <span class="o">=</span> <span class="n">MBV01_KEY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">mbv01_metadata</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">mbv01_validation</span><span class="o">.</span><span class="n">splits</span><span class="p">[</span><span class="n">dataset_name</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Only </span><span class="si">{</span><span class="n">MBV01_KEY</span><span class="si">}</span><span class="s2"> available. No other benchmarks defined!&quot;</span>
        <span class="p">)</span>

    <span class="c1"># keeping track of folds</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">folds_nums</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">)))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folds_nums</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">))</span>

    <span class="c1"># Alias for ease of use</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">folds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_nums</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">RecursiveDotDict</span><span class="p">({})</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.as_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Return a MatbenchTask object as a dictionary.</p>
<p>Required method from MSONAble.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>(dict)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a MatbenchTask object as a dictionary.</span>

<span class="sd">    Required method from MSONAble.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (dict)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;@module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
        <span class="s2">&quot;@class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BENCHMARK_KEY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">benchmark_name</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_DATASET_KEY</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_RESULTS_KEY</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">),</span>
    <span class="p">}</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.from_dict" class="doc doc-heading">
<code class="highlight language-python"><span class="n">from_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-classmethod"><code>classmethod</code></small>
  </span>

</h2>

    <div class="doc doc-contents ">

      <p>Create a MatbenchTask from a dictionary input.</p>
<p>Required method from MSONable.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>d</code></td>
        <td><code>dict</code></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>(MatbenchTask)</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a MatbenchTask from a dictionary input.</span>

<span class="sd">    Required method from MSONable.</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict):</span>

<span class="sd">    Returns:</span>
<span class="sd">        (MatbenchTask)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">req_base_keys</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;@module&quot;</span><span class="p">,</span>
        <span class="s2">&quot;@class&quot;</span><span class="p">,</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_DATASET_KEY</span><span class="p">,</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_RESULTS_KEY</span><span class="p">,</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_BENCHMARK_KEY</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">req_base_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Required key &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; not found.&quot;</span><span class="p">)</span>
    <span class="n">extra_base_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_base_keys</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">extra_base_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extra keys </span><span class="si">{</span><span class="n">extra_base_keys</span><span class="si">}</span><span class="s2"> not allowed.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_args</span><span class="p">(</span>
        <span class="n">dataset_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_DATASET_KEY</span><span class="p">],</span>
        <span class="n">benchmark_name</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_BENCHMARK_KEY</span><span class="p">],</span>
        <span class="n">results_dict</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">_RESULTS_KEY</span><span class="p">],</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.get_test_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s1">&#39;tuple&#39;</span><span class="p">,</span> <span class="n">include_target</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>The test data used for recording benchmarks.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>fold_number</code></td>
        <td></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_test_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;tuple&quot;</span><span class="p">,</span> <span class="n">include_target</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The test data used for recording benchmarks.</span>

<span class="sd">    Args:</span>
<span class="sd">        fold_number:</span>

<span class="sd">    Returns:</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_loaded</span><span class="p">()</span>
    <span class="n">fold_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">test</span>
    <span class="k">if</span> <span class="n">include_target</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;tuple&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">as_type</span> <span class="o">==</span> <span class="s2">&quot;df&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)[</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">input_type</span><span class="p">]</span>
            <span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.get_train_and_val_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_train_and_val_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s1">&#39;tuple&#39;</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>The training + validation data. All model tuning and
hyperparameter selection must be done on this data, NOT test data.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>fold_number</code></td>
        <td></td>
        <td></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_train_and_val_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;tuple&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The training + validation data. All model tuning and</span>
<span class="sd">    hyperparameter selection must be done on this data, NOT test data.</span>

<span class="sd">    Args:</span>
<span class="sd">        fold_number:</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_is_loaded</span><span class="p">()</span>
    <span class="n">fold_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span>
    <span class="n">ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">train</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">ids</span><span class="p">,</span> <span class="n">as_type</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.load" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Load the dataset for this task into memory.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>None</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Load the dataset for this task into memory.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">&#39;...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> loaded.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Dataset </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> already loaded; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;not reloading dataset.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.record" class="doc doc-heading">
<code class="highlight language-python"><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Record the test data as well as parameters about the model
trained on this fold.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>fold_number</code></td>
        <td><code>int</code></td>
        <td><p>The fold number.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>predictions</code></td>
        <td><code>[float] or [bool] or np.ndarray</code></td>
        <td><p>A list of predictions for</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>ci</code></td>
        <td><code>[tuple] or [list] or np.ndarray</code></td>
        <td><p>A list of 95% confidence</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>std</code></td>
        <td><code>[float] or np.ndarray</code></td>
        <td><p>A list of prediction standard deviations</p></td>
        <td><code>None</code></td>
      </tr>
      <tr>
        <td><code>params</code></td>
        <td><code>dict</code></td>
        <td><p>Any free-form parameters for information
about the algorithm on this fold. For example,
hyperparameters determined during validation. Parameters
must be a dictionary; dictionary types must adhere to
the same requirements as in the MatbenchBenchmark.add_metadata
docstring.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>None</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fold_number</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Record the test data as well as parameters about the model</span>
<span class="sd">    trained on this fold.</span>

<span class="sd">    Args:</span>
<span class="sd">        fold_number (int): The fold number.</span>
<span class="sd">        predictions ([float] or [bool] or np.ndarray): A list of predictions for</span>
<span class="sd">        fold number {fold_number}</span>
<span class="sd">        ci ([tuple] or [list] or np.ndarray): A list of 95% confidence</span>
<span class="sd">        intervals on predictions for fold number {fold_number}. By default</span>
<span class="sd">        None. Only one of `ci` or `std` should be specified, not both.</span>
<span class="sd">        std ([float] or np.ndarray): A list of prediction standard deviations</span>
<span class="sd">        for fold number {fold_number}. By default None. Only one of</span>
<span class="sd">        `ci` or `std` should be specified, not both.</span>
<span class="sd">        params (dict): Any free-form parameters for information</span>
<span class="sd">            about the algorithm on this fold. For example,</span>
<span class="sd">            hyperparameters determined during validation. Parameters</span>
<span class="sd">            must be a dictionary; dictionary types must adhere to</span>
<span class="sd">            the same requirements as in the MatbenchBenchmark.add_metadata</span>
<span class="sd">            docstring.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Fold number </span><span class="si">{</span><span class="n">fold_number</span><span class="si">}</span><span class="s2"> already recorded! Aborting record...&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># avoid problems with json serialization</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">std</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ci</span> <span class="o">=</span> <span class="n">ci</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;Both standard deviation (`std`) and confidence</span>
<span class="sd">                intervals (`ci`) were specified as kwargs. Only one</span>
<span class="sd">                should be specified, not both.&quot;&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">fold_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_map</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span>

        <span class="c1"># create map of original df index to prediction, e.g.,</span>
        <span class="c1"># {ix_of_original_df1: prediction1, ... etc.}</span>

        <span class="n">split_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">test</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Prediction outputs must be the same length as the &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;inputs! </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">ids_to_predictions</span> <span class="o">=</span> <span class="p">{</span><span class="n">split_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">predictions</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids_to_predictions</span>

        <span class="k">if</span> <span class="n">std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ci</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;task_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;classification&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;`std` and `ci` are not valid kwargs for classification &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;tasks. See &quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;https://github.com/materialsproject/matbench/pull/99/files#issuecomment-1022662192.&quot;</span>  <span class="c1"># noqa: E501</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">ci</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">low_p</span> <span class="o">=</span> <span class="mf">0.05</span>
                <span class="n">high_p</span> <span class="o">=</span> <span class="mf">0.95</span>
                <span class="c1"># convert from two-tail to one-tail probabilities</span>
                <span class="c1"># for compatibility with `ppf`</span>
                <span class="c1"># https://stackoverflow.com/a/29562808/13697228</span>
                <span class="n">low_p</span> <span class="o">=</span> <span class="n">low_p</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="n">high_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">high_p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="c1"># convert std to ci, modified from source:</span>
                <span class="c1"># https://github.com/uncertainty-toolbox/uncertainty-toolbox/blob/b2f342f6606d1d667bf9583919a663adf8643efe/uncertainty_toolbox/metrics_scoring_rule.py#L187 # noqa: E501</span>
                <span class="n">pred_l</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">low_p</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>
                <span class="n">pred_u</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">high_p</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">predictions</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">std</span><span class="p">)</span>
                <span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pred_l</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">pred_u</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">ci</span> <span class="o">=</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">std</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># std calculated and stored iff ci is symmetric within tol</span>
                <span class="n">pred_l</span><span class="p">,</span> <span class="n">pred_u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ci</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="o">-</span><span class="n">pred_l</span><span class="p">,</span> <span class="n">pred_u</span><span class="p">):</span>
                    <span class="n">high_p</span> <span class="o">=</span> <span class="mf">0.95</span>
                    <span class="c1"># convert from two-tail to one-tail probabilities for</span>
                    <span class="c1"># compatibility with `ppf`</span>
                    <span class="c1"># https://stackoverflow.com/a/29562808/13697228</span>
                    <span class="n">high_p</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">high_p</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="n">std</span> <span class="o">=</span> <span class="p">(</span><span class="n">pred_u</span> <span class="o">-</span> <span class="n">pred_l</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">high_p</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">std</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Confidence interval outputs (derived from standard</span>
<span class="s2">                     deviations if `std` was supplied) must be the same</span>
<span class="s2">                     length as the inputs! </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ci</span><span class="p">)</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">split_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
                <span class="p">)</span>

            <span class="n">ids_to_uncertainties</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">split_ids</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="p">{</span><span class="s2">&quot;ci_lower&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;ci_upper&quot;</span><span class="p">:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">}</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">std</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">ids_to_uncertainties</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Parameters must be stored as a dictionary, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">params</span><span class="p">)</span><span class="si">}</span><span class="s2">!&quot;</span>
            <span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">immutify_dictionary</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_PARAMS_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_recorded</span><span class="p">[</span><span class="n">fold_number</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Recorded fold &quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">fold_number</span><span class="si">}</span><span class="s2"> successfully.&quot;</span>
        <span class="p">)</span>

        <span class="n">truth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_data_from_df</span><span class="p">(</span><span class="n">split_ids</span><span class="p">,</span> <span class="n">as_type</span><span class="o">=</span><span class="s2">&quot;tuple&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">]</span> <span class="o">=</span> <span class="n">score_array</span><span class="p">(</span>
            <span class="n">truth</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Scored fold &#39;&quot;</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2"> successfully.&quot;</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h2 id="matbench.task.MatbenchTask.validate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


</h2>

    <div class="doc doc-contents ">

      <p>Validate a task after all folds have been recorded.</p>
<p>There are a few requirements for a task to be validated:
- Data types of each predicted sample must match those
    specified by the validation procedure
- All folds must be recorded
- There must be no extra or missing required keys from
    the data, including indices. Every index specified in
    the validation procedure must be present in its
    correct fold, and no extras may be present.
- Ensure consistency of the supplied uncertainty values.
    For example, if std is specified and ci is specified
    for one sample, it must be specified for all samples.
    If ci is specified but std is not, that must be
    consistent for all samples.</p>

        <details class="quote">
          <summary>Source code in <code>matbench/task.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Validate a task after all folds have been recorded.</span>

<span class="sd">    There are a few requirements for a task to be validated:</span>
<span class="sd">    - Data types of each predicted sample must match those</span>
<span class="sd">        specified by the validation procedure</span>
<span class="sd">    - All folds must be recorded</span>
<span class="sd">    - There must be no extra or missing required keys from</span>
<span class="sd">        the data, including indices. Every index specified in</span>
<span class="sd">        the validation procedure must be present in its</span>
<span class="sd">        correct fold, and no extras may be present.</span>
<span class="sd">    - Ensure consistency of the supplied uncertainty values.</span>
<span class="sd">        For example, if std is specified and ci is specified</span>
<span class="sd">        for one sample, it must be specified for all samples.</span>
<span class="sd">        If ci is specified but std is not, that must be</span>
<span class="sd">        consistent for all samples.</span>
<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_folds_recorded</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Cannot validate task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;unless all folds recorded!&quot;</span>
    <span class="p">)</span>
    <span class="n">task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span>

    <span class="c1"># Check for extra fold keys</span>
    <span class="n">extra_fold_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">extra_fold_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Extra fold keys </span><span class="si">{</span><span class="n">extra_fold_keys</span><span class="si">}</span><span class="s2"> for task &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not allowed.&quot;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">fold_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">folds_keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fold_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Required fold data for fold &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not found.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check for extra or missing keys inside each fold:</span>
        <span class="c1"># need params, scores, and data.</span>
        <span class="n">req_subfold_keys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PARAMS_KEY</span><span class="p">]</span>
        <span class="n">extra_subfold_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_subfold_keys</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span> <span class="ow">in</span> <span class="n">extra_subfold_keys</span><span class="p">:</span>
            <span class="n">extra_subfold_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extra_subfold_keys</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Extra keys </span><span class="si">{</span><span class="n">extra_subfold_keys</span><span class="si">}</span><span class="s2"> for fold results of &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39; for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2">  not allowed.&quot;</span>
            <span class="p">)</span>
        <span class="n">req_subfold_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">subkey</span> <span class="ow">in</span> <span class="n">req_subfold_keys</span><span class="p">:</span>
            <span class="n">fold_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">subkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span>
                <span class="ow">and</span> <span class="n">subkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fold_results</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Required key &#39;</span><span class="si">{</span><span class="n">subkey</span><span class="si">}</span><span class="s2">&#39; for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;not found for fold &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">subkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SCORES_KEY</span><span class="p">:</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="n">subkey</span><span class="p">]</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="n">REG_METRICS</span> <span class="k">if</span> <span class="n">task_type</span> <span class="o">==</span> <span class="n">REG_KEY</span> <span class="k">else</span> <span class="n">CLF_METRICS</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">m</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Required score &#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&#39; for task &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;not found for &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39;.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Required score &#39;</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">&#39; for task &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;is not float-type for &#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39;!&quot;</span>
                        <span class="p">)</span>
                <span class="n">extra_metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">scores</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">extra_metrics</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Extra keys </span><span class="si">{</span><span class="n">extra_metrics</span><span class="si">}</span><span class="s2"> for fold scores of &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">&#39; for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;not allowed.&quot;</span>
                    <span class="p">)</span>

            <span class="c1"># results data indices are cast by json to be strings,</span>
            <span class="c1"># so must be converted to int</span>
            <span class="k">elif</span> <span class="n">subkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_DATA_KEY</span><span class="p">:</span>
                <span class="n">fold_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

                <span class="c1"># Ensure all the indices are present with no</span>
                <span class="c1"># extras for each fold</span>
                <span class="n">req_indices</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
                <span class="n">remaining_indices</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">req_indices</span><span class="p">)</span>
                <span class="n">extra_indices</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span> <span class="o">==</span> <span class="n">REG_KEY</span><span class="p">:</span>
                    <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">allowed_types</span> <span class="o">=</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">ix</span><span class="p">,</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">fold_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ix</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">req_indices</span><span class="p">:</span>
                        <span class="n">extra_indices</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">datum</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="n">allowed_types</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Data point &#39;</span><span class="si">{</span><span class="n">ix</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">datum</span><span class="si">}</span><span class="s2">&#39; has data type &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span><span class="si">}</span><span class="s2"> while required type is &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">allowed_types</span><span class="si">}</span><span class="s2"> for task &quot;</span>
                                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> !&quot;</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">task_type</span> <span class="o">==</span> <span class="n">CLF_KEY</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">datum</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">datum</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                        <span class="sa">f</span><span class="s2">&quot;Probability estimate &#39;</span><span class="si">{</span><span class="n">ix</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">datum</span><span class="si">}</span><span class="s2">&quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;for task </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> outside &quot;</span>
                                        <span class="sa">f</span><span class="s2">&quot;of range [0, 1].&quot;</span>
                                    <span class="p">)</span>

                        <span class="n">remaining_indices</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ix</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">extra_indices</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">remaining_indices</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extra_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> extra indices for problem &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> are not allowed (found in &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">remaining_indices</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">extra_indices</span> <span class="ow">and</span> <span class="n">remaining_indices</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> required indices &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;for problem </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;found for </span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">remaining_indices</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">extra_indices</span> <span class="ow">and</span> <span class="n">remaining_indices</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">remaining_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> required indices &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;for problem </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> not &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;found and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">extra_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> not &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;allowed indices found for </span><span class="si">{</span><span class="n">fold_key</span><span class="si">}</span><span class="s2">!&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">subkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_UNCERTAINTY_KEY</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">uncertainties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="n">fold_key</span><span class="p">][</span><span class="n">subkey</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">uncertainties</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">uncertainties</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">std</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="s2">&quot;std&quot;</span><span class="p">]</span>
                    <span class="n">ci</span> <span class="o">=</span> <span class="n">uncertainties</span><span class="p">[</span><span class="s2">&quot;ci&quot;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                    <span class="s2">&quot;std specified for all samples &quot;</span>
                                    <span class="s2">&quot;but ci not specified for some.&quot;</span>
                                <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;std is specified for some, but not for all.&quot;</span>
                            <span class="p">)</span>

                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">std</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                    <span class="s2">&quot;ci specified for all samples &quot;</span>
                                    <span class="s2">&quot;but ci not specified for some.&quot;</span>
                                <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ci</span><span class="p">):</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                <span class="s2">&quot;ci is specified for some, but not for all.&quot;</span>
                            <span class="p">)</span>

            <span class="c1"># Params key has no required form;</span>
            <span class="c1"># it is up to the model to determine it.</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset_name</span><span class="si">}</span><span class="s2"> successfully validated.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../MatbenchBenchmark/" class="md-footer__link md-footer__link--prev" aria-label="Previous: MatbenchBenchmark" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              MatbenchBenchmark
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Materials Project (Maintained by Alex Dunn of HackingMaterials Group)
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>